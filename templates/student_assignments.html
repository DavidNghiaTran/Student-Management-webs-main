{% extends "_layout.html" %}

{% block title %}Bài tập được giao{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">Bài tập được giao - Lớp {{ sv.lop or 'N/A' }}</div>
    <div class="card-body">
        {% if not assignments_data %}
        <p>Chưa có bài tập nào được giao cho lớp của bạn.</p>
        {% else %}
        <table class="data-table">
            <thead>
                <tr>
                    <th>Tiêu đề</th>
                    <th>Môn</th>
                    <th>Hạn nộp</th>
                    <th>Nội dung</th>
                    <th>File đề bài</th>
                    <th>Trạng thái</th>
                    <th>Nộp bài</th>
                </tr>
            </thead>
            <tbody>
                {% for item in assignments_data %}
                {% set a = item.assignment %}
                {% set sub = item.submission %}
                {% set overdue = a.han_nop and a.han_nop < today %} <tr {% if overdue
                    %}style="background: rgba(220,38,38,0.05);" {% endif %}>
                    <td>{{ a.tieu_de }}</td>
                    <td>{{ a.mon_hoc.ten_mh if a.mon_hoc else (a.ma_mh or '-') }}</td>
                    <td>
                        {% if a.han_nop %}
                        <strong style="color: {% if overdue %}var(--danger-color){% else %}inherit{% endif %};">
                            {{ a.han_nop.strftime('%d/%m/%Y') }}
                        </strong>
                        {% else %}
                        -
                        {% endif %}
                    </td>
                    <td style="max-width:260px;">{{ a.noi_dung }}</td>
                    <td>
                        {% if a.tep_dinh_kem %}
                        <a href="{{ url_for('download_file', filename=a.tep_dinh_kem) }}" target="_blank"
                            class="btn btn-sm btn-outline-primary">Tải đề</a>
                        {% else %}
                        -
                        {% endif %}
                    </td>
                    <td>
                        {% if sub %}
                        <span class="badge badge-success">Đã nộp</span>
                        <br>
                        <small>{{ sub.ngay_nop.strftime('%d/%m %H:%M') }}</small>
                        <br>
                        <a href="{{ url_for('download_file', filename=sub.file_path) }}" target="_blank">Xem bài</a>
                        {% else %}
                        <span class="badge badge-warning">Chưa nộp</span>
                        {% endif %}
                    </td>
                    <td>
                        <form method="post" action="{{ url_for('student_submit_homework', assignment_id=a.id) }}"
                            enctype="multipart/form-data" style="display:flex; flex-direction:column; gap:5px;">
                            <input type="file" name="file_nop" required accept=".pdf,.doc,.docx,.zip,.rar,.png,.jpg"
                                style="font-size:0.8em; width: 180px;" />
                            <button type="submit" class="btn btn-primary btn-sm">
                                {{ 'Nộp lại' if sub else 'Nộp bài' }}
                            </button>
                        </form>
                    </td>
                    </tr>
                    {% endfor %}
            </tbody>
        </table>
        {% endif %}
    </div>
</div>
{% endblock %}